<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>

<body>

    <img class="" id="myimg" src="img/01.png" alt="" style="position:relative; width: 50px; height: 50px;">

    <script>
        var imgarray = [];
        var target = [];
        var cnt = 1;
        var img = document.getElementById('myimg');

        imgarray.push(img);
        target.push(img);
        document.addEventListener('keydown', (event) => {
            if (event.code === 'Space') {
                const newImg = document.createElement('img');
                newImg.src = 'img/01.png';
                newImg.style = 'position:absolute; width: 50px; height: 50px;';
                let x, y;
                y = Math.random() * window.innerWidth;
                x = Math.random() * window.innerHeight;
                newImg.style.top = `${x - 25}px`;
                newImg.style.left = `${y - 25}px`;
                imgarray[cnt] = newImg;
                target[cnt] = imgarray[cnt - 1];
                cnt++;
                document.body.appendChild(newImg);

            }
        })

        document.addEventListener('click', function (event) {
            const newImg = document.createElement('img');
            newImg.src = 'img/01.png';
            newImg.style = 'position:absolute; width: 50px; height: 50px;';
            let x, y;
            y = Math.random() * window.innerWidth;
            x = Math.random() * window.innerHeight;
            newImg.style.top = `${x - 25}px`;
            newImg.style.left = `${y - 25}px`;
            imgarray[cnt] = newImg;
            target[cnt] = imgarray[cnt - 1];
            cnt++;
            document.body.appendChild(newImg);
        })
        var targetVector = [0, 0];
        var currentVector = targetVector;
        var mousePOS = targetVector;

        document.addEventListener('mousemove', function (event) {
            mousePOS[1] = event.clientX;
            mousePOS[0] = event.clientY;

        });



        var timerId = setInterval(async function () {
            for (let i = 0; i < imgarray.length; i++) {

                setTimeout(() => {
                    if (i == 0) {
                        targetVector = mousePOS;
                    } else {
                        targetVector = getPOS(target[i]);
                    }

                    currentVector = getPOS(imgarray[i]);
                    //console.log("target:" + i.toString() + "," + targetVector[0] + "," + targetVector[1]);
                    // console.log("current:" + i.toString() + "," + currentVector[0] + "," + currentVector[1]);

                    currentVector[0] = Math.round(currentVector[0] * 0.9 + targetVector[0] * .1);//(Number(x) * 0.9 + Number(tx) * 0.1)
                    currentVector[1] = Math.round(currentVector[1] * 0.9 + targetVector[1] * .1);//(Number(y) * 0.9 + Number(ty) * 0.1);
                    // console.log("adjust:" + i.toString() + "," + currentVector[0] + "," + currentVector[1]);

                    let angle = Math.atan2(currentVector[0] - targetVector[0], currentVector[1] - targetVector[1]) * 180 / Math.PI;
                    angle = angle - 90;
                    imgarray[i].style.transform = 'rotate(' + angle + 'deg)';
                    console.log(angle);
                    imgarray[i].style.opacity = 1-(i/(imgarray.length-1));
                    if (dist(currentVector, targetVector) > 5) {
                        setPOS(imgarray[i], currentVector);
                    }
                }, 1 * i);

            }

        }, 10);

        function dist(vect1, vect2) {
            return Math.round(Math.pow(Math.pow(vect1[0] - vect2[0], 2) + Math.pow(vect1[1] - vect2[1], 2), 0.5));
        }


        function getPOS(img) {
            var x, y;
            x = img.style.top;
            y = img.style.left;
            y = Number(y.slice(0, y.length - 2)) + 25;
            x = Number(x.slice(0, x.length - 2)) + 25;
            return [x, y];
        }

        function setPOS(myimg, vector) {
            myimg.style.top = `${vector[0] - 25}px`;
            myimg.style.left = `${vector[1] - 25}px`;
        }



    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
        </script>
</body>

</html>